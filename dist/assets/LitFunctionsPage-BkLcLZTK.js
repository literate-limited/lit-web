import{j as e,r as b}from"./index-D0UK4MyN.js";import{k as G,l as q,m as H,n as J,o as K}from"./index-DpCu-vl3.js";import{c as Q}from"./expressionParser-D4TmW7YG.js";const ee=({functions:r,onChange:l,onAdd:x,onRemove:f,onToggleVisibility:y,onResetView:u})=>e.jsxs("aside",{className:"w-[360px] shrink-0 border-r border-slate-800/70 bg-[#0d1428]/80 backdrop-blur-xl text-slate-100",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-800/70",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.3em] text-cyan-300/80",children:"LitðŸ”¥ Functions"}),e.jsx("p",{className:"text-lg font-semibold",children:"Plotting stack"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Build your set, color it, and watch the canvas react in real time."})]}),e.jsxs("button",{type:"button",onClick:u,className:"group inline-flex h-10 items-center gap-2 rounded-full border border-slate-700/60 px-3 text-xs font-semibold text-slate-200 transition hover:border-cyan-400/70 hover:text-cyan-200",children:[e.jsx(G,{className:"h-4 w-4 transition group-hover:rotate-90"}),"Reset view"]})]}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Functions"}),e.jsx("p",{className:"text-[11px] text-slate-400",children:"Use x as your variable. Supports pi/e/tau, trig, log/ln/log10/log2, sqrt/cbrt, abs(|x|), ^ or ** for powers, min/max/clamp, and implicit multiplication like 2x or y=2x."})]}),e.jsx("button",{type:"button",onClick:x,className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-cyan-500/90 to-emerald-400/90 text-slate-900 shadow-lg shadow-cyan-500/20 active:scale-[0.98]",children:e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"space-y-3 px-4 pb-6",children:[r.map(s=>e.jsxs("div",{className:"rounded-2xl border border-slate-800/80 bg-slate-900/60 p-4 shadow-[0_10px_40px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:[s.label,"(x)",!s.visible&&e.jsx("span",{className:"ml-2 rounded-full bg-slate-800 px-2 py-0.5 text-[11px] uppercase tracking-wide text-slate-400",children:"Hidden"})]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Color + expression feed the canvas live."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color","aria-label":`${s.label} color`,value:s.color,onChange:v=>l(s.id,{color:v.target.value}),className:"h-10 w-10 cursor-pointer rounded-lg border border-slate-700 bg-slate-900 p-1"}),e.jsx("button",{type:"button",onClick:()=>y(s.id),className:"flex h-10 w-10 items-center justify-center rounded-lg border border-slate-700/70 bg-slate-900 text-slate-200 transition hover:border-cyan-400/60 hover:text-cyan-200",children:s.visible?e.jsx(H,{size:18}):e.jsx(J,{size:18})}),e.jsx("button",{type:"button",onClick:()=>f(s.id),className:"flex h-10 w-10 items-center justify-center rounded-lg border border-slate-800/70 bg-slate-900 text-slate-400 transition hover:border-rose-500/70 hover:text-rose-200","aria-label":`Remove ${s.label}`,children:e.jsx(K,{size:18})})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("label",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500",children:"Expression"}),e.jsx("input",{type:"text",value:s.expression,onChange:v=>l(s.id,{expression:v.target.value}),placeholder:"e.g., sin(x) + 0.5*x^2",className:"w-full rounded-xl border border-slate-800/70 bg-[#0d1428] px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-cyan-400/70 focus:outline-none"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-slate-500",children:[e.jsx("span",{className:"mathmadness-mono",children:"Sample: sin(x), cos(x/2)+1, e^(x), |x|, log10(100), clamp(x,-2,2)"}),s.error?e.jsx("span",{className:"rounded-full bg-amber-500/10 px-3 py-1 text-[11px] text-amber-200",children:s.error}):e.jsx("span",{className:"rounded-full bg-emerald-400/10 px-3 py-1 text-[11px] text-emerald-200",children:"Live"})]})]})]},s.id)),r.length===0&&e.jsx("div",{className:"rounded-xl border border-dashed border-slate-700/70 bg-slate-900/40 px-4 py-5 text-center text-sm text-slate-400",children:"No functions yet. Tap the green plus to start plotting."})]})]}),U=(r,l,x)=>Math.min(x,Math.max(l,r)),A=r=>Math.abs(r)<1?r.toFixed(2):Math.abs(r)<10?r.toFixed(1):r.toFixed(0),S=14,Y=520,te=90,se=({functions:r,viewState:l,setViewState:x})=>{const f=b.useRef(null),y=b.useRef(null),u=b.useRef(null),[s,v]=b.useState({width:0,height:0});b.useEffect(()=>{if(!y.current)return;const o=new ResizeObserver(t=>{const c=t[0];if(!c)return;const{width:n,height:g}=c.contentRect;v({width:n,height:g})});return o.observe(y.current),()=>o.disconnect()},[]);const C=b.useCallback(()=>{const o=f.current;if(!o||!s.width||!s.height)return;const t=o.getContext("2d"),c=window.devicePixelRatio||1;o.width=s.width*c,o.height=s.height*c,t.setTransform(c,0,0,c,0,0);const{scale:n,offsetX:g,offsetY:j}=l,k=s.width/2,M=s.height/2;t.clearRect(0,0,s.width,s.height);const R=t.createLinearGradient(0,0,s.width,s.height);R.addColorStop(0,"rgba(19, 34, 70, 0.85)"),R.addColorStop(1,"rgba(6, 12, 30, 0.9)"),t.fillStyle=R,t.fillRect(0,0,s.width,s.height);const E=90/n,T=Math.pow(10,Math.floor(Math.log10(E))),L=E/T;let p=T;L>=5?p=5*T:L>=2&&(p=2*T);const D=(-k-g)/n,_=(s.width-k-g)/n,I=(M+j-s.height)/n,Z=(M+j)/n,N=(a,i)=>({x:k+g+a*n,y:M+j-i*n});t.lineWidth=1,t.strokeStyle="rgba(148,163,184,0.1)",t.font="10px 'IBM Plex Mono', monospace",t.fillStyle="rgba(148,163,184,0.6)";const $=Math.ceil(D/p)*p;for(let a=$;a<=_;a+=p){const{x:i}=N(a,0);t.beginPath(),t.moveTo(i,0),t.lineTo(i,s.height),t.stroke(),Math.abs(a)>p/2&&t.fillText(A(a),i+4,M+j-6)}const V=Math.ceil(I/p)*p;for(let a=V;a<=Z;a+=p){const{y:i}=N(0,a);t.beginPath(),t.moveTo(0,i),t.lineTo(s.width,i),t.stroke(),Math.abs(a)>p/2&&t.fillText(A(a),k+g+6,i-4)}t.strokeStyle="rgba(226,232,240,0.85)",t.lineWidth=1.6,t.beginPath(),t.moveTo(0,N(0,0).y),t.lineTo(s.width,N(0,0).y),t.moveTo(N(0,0).x,0),t.lineTo(N(0,0).x,s.height),t.stroke(),r.filter(a=>a.visible&&a.evaluator).forEach(a=>{t.beginPath(),t.strokeStyle=a.color,t.lineWidth=2,t.shadowColor=`${a.color}80`,t.shadowBlur=10;let i=!1;const O=1.5;for(let F=0;F<=s.width;F+=O){const W=(F-k-g)/n;let X;try{X=a.evaluator(W)}catch{i=!1;continue}if(!Number.isFinite(X)){i=!1;continue}const z=M+j-X*n;i?t.lineTo(F,z):(t.moveTo(F,z),i=!0)}t.stroke(),t.shadowBlur=0})},[r,s,l]);b.useEffect(()=>{C()},[C]);const P=(o,t)=>{if(!s.width||!s.height)return{...o,scale:t};const c=-o.offsetX/o.scale,n=o.offsetY/o.scale,g=-c*t,j=n*t;return{scale:t,offsetX:g,offsetY:j}},d=o=>{const t=U(o,S,Y);x(c=>P(c,t))},h=o=>{x(t=>P(t,U(t.scale*o,S,Y)))},m=o=>{u.current={x:o.clientX,y:o.clientY}},w=()=>{u.current=null},B=o=>{u.current&&x(t=>{const c=o.clientX-u.current.x,n=o.clientY-u.current.y;return u.current={x:o.clientX,y:o.clientY},{...t,offsetX:t.offsetX+c,offsetY:t.offsetY+n}})};return e.jsx("div",{className:"relative flex-1 overflow-hidden",children:e.jsxs("div",{ref:y,className:"mathmadness-grid relative h-full w-full rounded-l-3xl border-l border-slate-800/70 bg-gradient-to-br from-[#0a142c] via-[#0a1a34] to-[#071422]",children:[e.jsx("canvas",{ref:f,className:"h-full w-full cursor-crosshair",onPointerDown:m,onPointerMove:B,onPointerUp:w,onPointerLeave:w}),e.jsxs("div",{className:"pointer-events-none absolute left-6 top-6 rounded-2xl border border-cyan-400/30 bg-slate-900/70 px-4 py-3 text-sm text-slate-100 shadow-lg shadow-cyan-500/10 backdrop-blur",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.25em] text-cyan-300",children:"Controls"}),e.jsx("p",{className:"mathmadness-mono text-sm text-slate-100",children:"Use zoom controls Â· Drag to pan Â· Values update live"})]}),e.jsxs("div",{className:"absolute right-6 top-6 rounded-2xl border border-slate-700/60 bg-slate-950/70 px-4 py-3 text-xs text-slate-100 shadow-lg shadow-slate-900/60 backdrop-blur",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-slate-400",children:"Zoom"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h(.9),"aria-label":"Zoom out",className:"flex h-8 w-8 items-center justify-center rounded-lg border border-slate-700/70 bg-slate-900 text-slate-200 transition hover:border-cyan-400/60 hover:text-cyan-200",children:"-"}),e.jsx("input",{type:"range",min:S,max:Y,step:2,value:Math.round(l.scale),onChange:o=>d(Number(o.target.value)),"aria-label":"Zoom level",className:"h-2 w-32 cursor-pointer accent-cyan-400"}),e.jsx("button",{type:"button",onClick:()=>h(1.1),"aria-label":"Zoom in",className:"flex h-8 w-8 items-center justify-center rounded-lg border border-slate-700/70 bg-slate-900 text-slate-200 transition hover:border-cyan-400/60 hover:text-cyan-200",children:"+"})]}),e.jsxs("p",{className:"mt-2 text-[10px] text-slate-400",children:[Math.round(l.scale/te*100),"% scale"]})]}),e.jsx("div",{className:"pointer-events-none absolute bottom-6 right-6 rounded-full border border-emerald-400/40 bg-emerald-400/10 px-4 py-2 text-xs text-emerald-100 backdrop-blur",children:"Math-Madness Â· LitðŸ”¥ Functions"})]})})},oe=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`fn-${Math.random().toString(16).slice(2)}`,re=[{id:"f1",label:"f1",expression:"sin(x)",color:"#22d3ee",visible:!0},{id:"f2",label:"f2",expression:"0.3*x^2 - 2",color:"#f59e0b",visible:!0}],ae=r=>{const{evaluator:l,error:x}=Q(r.expression,{variables:["x"]});return l?{...r,evaluator:f=>l({x:f}),error:null}:{...r,evaluator:null,error:x??"Enter expression"}},de=()=>{const[r,l]=b.useState(re),[x,f]=b.useState({scale:90,offsetX:0,offsetY:0}),y=b.useMemo(()=>r.map(d=>ae(d)),[r]),u=(d,h)=>{l(m=>m.map(w=>w.id===d?{...w,...h}:w))},s=()=>{l(d=>{const h=d.length+1;return[...d,{id:oe(),label:`f${h}`,expression:"cos(x)",color:"#a855f7",visible:!0}]})},v=d=>{l(h=>h.filter(m=>m.id!==d))},C=d=>{l(h=>h.map(m=>m.id===d?{...m,visible:!m.visible}:m))},P=()=>f({scale:90,offsetX:0,offsetY:0});return e.jsxs("div",{className:"flex h-[calc(100vh-4rem)] min-h-[720px] overflow-hidden rounded-l-3xl",children:[e.jsx(ee,{functions:y,onChange:u,onAdd:s,onRemove:v,onToggleVisibility:C,onResetView:P}),e.jsx(se,{functions:y,viewState:x,setViewState:f})]})};export{de as default};
